<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Moving files between git repositories, preserving history &middot; Diego</title>

  
  <link rel="stylesheet" href="../../css/poole.css">
  <link rel="stylesheet" href="../../css/hyde.css">
  <link rel="stylesheet" href="../../css/poole-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-x.css">
  <link rel="stylesheet" type="text/css" href="../../css/socialicious.css" media="screen" />
  <link rel="stylesheet" href="../../css/highlight/github.css">
  <link href='http://fonts.googleapis.com/css?family=Quattrocento|Quattrocento+Sans' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:64046/new/apple-touch-icon-144-precomposed.png">
  <link href="../../favicon.png" rel="icon">

  
  <link href="index.html" rel="alternate" type="application/rss+xml" title="zzamboni &middot; Diego" />

  <meta name="description" content="">
  <meta name="keywords" content="">
  
</head>
<body>
<div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
      <h1>zzamboni</h1>
      <p class="lead">Thoughts and musings.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="../../index.html">Home</a></li>
      
      
       
      
    </ul>

    <ul class="sidebar-nav">
      <a href="http://github.com/zzamboni/"><li class="icon-github"></li></a>&nbsp;
      <a href="http://mx.linkedin.com/in/zzamboni"><li class="icon-linkedin"></li></a>&nbsp;
      <a href="http://twitter.com/zzamboni"><li class="icon-twitter"></li></a>&nbsp;
      
      
    </ul>

    <div class="sidebar-sticky"><p>&copy; 2017 Diego Zamboni<br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p></div>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Moving files between git repositories, preserving history</h1>
    

<p>I needed to copy a directory between two <code>git</code> repositories while preserving its history. I found some good instructions at <a href='http://gbayer.com/development/moving-files-from-one-git-repository-to-another-preserving-history/'><a href="http://gbayer.com/development/moving-files-from-one-git-repository-to-another-preserving-history/">http://gbayer.com/development/moving-files-from-one-git-repository-to-another-preserving-history/</a></a>, which got me started, but I figured out a way to avoid having to move all the files into their directory again (lines 5-6 in Greg&rsquo;s instructions) by reversing the filter to remove everything I don&rsquo;t want instead of only including the directory I want. Here are the steps (the idea is the same as in Greg&rsquo;s post, so please read that to get the explanation, I&rsquo;m only listing the commands here for reference):</p>

<h2 id="get-files-ready-for-the-move">Get files ready for the move</h2>

<p>(<code>directory1</code> is the one you want to preserve)</p>

<pre><code>git clone git-repository-A-url repo-A-tmp-dir
cd repo-A-tmp
git remote rm origin   # for safety
git filter-branch --tree-filter 'rm -rf $(git ls-files | egrep -v directory1)' -- --all
</code></pre>

<p>(2016-06-08: update thanks to Pawel Veselov, using <code>git ls-files</code> instead of <code>ls</code> in the last command)</p>

<p>The last line replaces lines 4-8 in the original instructions.</p>

<p>At this point you should verify that only <code>directory1</code> remains in the repository, with the correct history. I used the following command to verify that only commits related to my desired directory remained:</p>

<pre><code>git log -p | grep '^diff ' | grep -v directory1
</code></pre>

<h2 id="merge-files-into-the-new-repository">Merge files into the new repository</h2>

<p>These steps are identical from Greg&rsquo;s instructions.</p>

<pre><code>git clone git-repository-B-url
cd git-repository-B-dir
git remote add repo-A-branch repo-A-tmp-dir
git pull repo-A-branch master
git remote rm repo-A-branch
</code></pre>

  </div>
</div>
<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-no-instant>document.write('<script src="http://localhost:64046/livereload.js?port=64046&amp;mindelay=10"></' + 'script>')</script></body>
</html>
